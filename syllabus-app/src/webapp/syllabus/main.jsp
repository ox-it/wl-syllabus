<%@ taglib uri="http://java.sun.com/jsf/html" prefix="h" %>
<%@ taglib uri="http://java.sun.com/jsf/core" prefix="f" %>
<%@ taglib uri="http://sakaiproject.org/jsf/sakai" prefix="sakai" %>
<%@ taglib uri="http://sakaiproject.org/jsf/syllabus" prefix="syllabus" %>
<%@ taglib uri="http://myfaces.apache.org/tomahawk" prefix="t"%>
<% response.setContentType("text/html; charset=UTF-8"); %>
<f:view>

<jsp:useBean id="msgs" class="org.sakaiproject.util.ResourceLoader" scope="session">
   <jsp:setProperty name="msgs" property="baseName" value="org.sakaiproject.tool.syllabus.bundle.Messages"/>
</jsp:useBean>

	<sakai:view_container title="#{msgs.title_list}">
	<sakai:view_content>
	
	<%
	  	String thisId = request.getParameter("panel");
  		if (thisId == null) 
  		{
    		thisId = "Main" + org.sakaiproject.tool.cover.ToolManager.getCurrentPlacement().getId();
  		}
	%>

<script type="text/javascript" src="/library/js/jquery.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.10.1.custom.min.js"></script>
<script type="text/javascript" src="js/syllabus.js"></script>
<sakai:stylesheet path="/syllabus/css/ui-lightness/jquery-ui-1.10.1.custom.min.css" />
<script language="JavaScript">
	// if redirected, just open in another window else
	// open with size approx what actual print out will look like
	function printFriendly(url) {
		if (url.indexOf("printFriendly") == -1) {
			window.open(url,"mywindow");
		}
		else {
			window.open(url,"mywindow","width=960,height=1100,scrollbars=yes"); 
		}
	}
	
	$(function() {
		setupAccordion('<%= org.sakaiproject.util.Web.escapeJavascript(thisId)%>'<h:outputText value=", true" rendered="#{SyllabusTool.editAble == 'true'}"/>);
	});
	
	
</script>
<style>
	a.draft{
		color: grey !important
	}
	.ui-accordion .ui-accordion-header{
		overflow: auto !important;
	}
	 /* IE has layout issues when sorting (see #5413) */
	.group { zoom: 1 }
	
	.imgMove{
		position: relative;
		top: 2px;
		right: 8px;
	}
</style>

<%-- gsilver: global things about syllabus tool:
1 ) what happens to empty lists - still generate a table?
2 ) Ids generated by jsf start with _  not optimal keeps us from validating fully.
 --%>
	<h:form id="syllabus">
		<%--gsilver: would be best if used all sakai tags, or none, 2 blocks
		following just gets tries to get around the mix --%>		
		<syllabus:syllabus_ifnot test="#{SyllabusTool.editAble}">
			<f:verbatim><ul class="navIntraTool actionToolbar"></f:verbatim>
				<f:verbatim><li class="firstToolBarItem"></f:verbatim>
					<f:verbatim><span></f:verbatim>
						<sakai:tool_bar_item
			    			action="#{SyllabusTool.processCreateAndEdit}"
							value="#{msgs.bar_create_edit}" />
					<f:verbatim></span></f:verbatim>
				<f:verbatim></li></f:verbatim>
				<f:verbatim><li></f:verbatim>
					<f:verbatim><span></f:verbatim>
						<h:outputLink id="print" value="javascript:printFriendly('#{SyllabusTool.printFriendlyUrl}');">
							<h:graphicImage url="/images/printer.png" alt="#{msgs.print_friendly}" title="#{msgs.print_friendly}" />
						</h:outputLink>
					<f:verbatim></span></f:verbatim>
				<f:verbatim></li></f:verbatim>
			<f:verbatim></ul></f:verbatim>			
		
		</syllabus:syllabus_ifnot>

		<syllabus:syllabus_if test="#{SyllabusTool.editAble}" >

			<f:verbatim><ul class="navIntraTool actionToolbar"></f:verbatim>
				<f:verbatim><li class="firstToolBarItem"></f:verbatim>
					<f:verbatim><span></f:verbatim>
						<h:outputLink id="printIcon" value="javascript:printFriendly('#{SyllabusTool.printFriendlyUrl}');">
							<h:graphicImage url="/images/printer.png" alt="#{msgs.print_friendly}" title="#{msgs.print_friendly}" />
						</h:outputLink>
					<f:verbatim></span></f:verbatim>
				<f:verbatim></li></f:verbatim>
			<f:verbatim></ul></f:verbatim>			
				
			</syllabus:syllabus_if>
			<syllabus:syllabus_if test="#{SyllabusTool.syllabusItem.redirectURL}">
					<f:verbatim>
						<br/>
						<a href="#" id="expandLink" style="float: right" onclick="expandAccordion('<%= org.sakaiproject.util.Web.escapeJavascript(thisId)%>')">
						</f:verbatim>
							<h:outputText value="#{msgs.expandAll}"/>
						<f:verbatim>
						</a>
						<a href="#" id="collapseLink" style="float: right; display:none" onclick="collapseAccordion('<%= org.sakaiproject.util.Web.escapeJavascript(thisId)%>')">
						</f:verbatim>
							<h:outputText value="#{msgs.collapseAll}"/>
						<f:verbatim>
						</a>
						<br/>
						<br/>
						<div id="accordion">
					</f:verbatim>
					<t:dataList value="#{SyllabusTool.entries}" var="eachEntry" layout="simple">
						<f:verbatim><div class="group" syllabusItem="</f:verbatim>
						<h:outputText value="#{eachEntry.entry.syllabusId}"/>
						<f:verbatim>"><h3></f:verbatim>
						<h:graphicImage url="/images/cursor_drag_arrow.png" rendered="#{SyllabusTool.editAble == 'true'}" styleClass="imgMove"/>
						<f:verbatim><a href="#" </f:verbatim>
							<f:subview id="draftclass" rendered="#{eachEntry.status == eachEntry.draftStatus}">
								<f:verbatim>class="draft"</f:verbatim>
							</f:subview>
							<f:verbatim>></f:verbatim>		 
							<h:outputText rendered="#{eachEntry.status == eachEntry.draftStatus}" value="#{msgs.mainDraft} - "/> 
							<h:outputText value="#{eachEntry.entry.title}" />
							<f:subview id="date" rendered="#{eachEntry.entry.startDate != null || eachEntry.entry.endDate != null}">
								<f:verbatim><span style="font-weight: normal; color: grey; float: right"></f:verbatim>
									<h:outputText value="#{eachEntry.entry.startDate}">
										<f:convertDateTime type="date" pattern="EEE MMM dd, yyyy hh:mm a"/>
									</h:outputText>
									<h:outputText value=" - " rendered="#{eachEntry.entry.startDate != null && eachEntry.entry.endDate != null}"/>
									<h:outputText value="#{eachEntry.entry.endDate}" rendered="#{!eachEntry.startAndEndDatesSameDay}">
								  		<f:convertDateTime type="date" pattern="EEE MMM dd, yyyy hh:mm a"/>
									</h:outputText>
									<h:outputText value="#{eachEntry.entry.endDate}" rendered="#{eachEntry.startAndEndDatesSameDay}">
								  		<f:convertDateTime type="date" pattern="hh:mm a"/>
									</h:outputText>
								<f:verbatim></span></f:verbatim>
							</f:subview>
							
						<f:verbatim></a></h3></f:verbatim>
						<f:verbatim><div></f:verbatim>
							<f:verbatim><div></f:verbatim>
							<syllabus:syllabus_htmlShowArea value="#{eachEntry.entry.asset}" />
							<f:verbatim></div></f:verbatim>
							<h:dataTable value="#{eachEntry.attachmentList}" var="eachAttach" styleClass="indnt1">
							  <h:column>
									<f:facet name="header">
										<h:outputText value="" />
									</f:facet>
									<sakai:contentTypeMap fileType="#{eachAttach.type}" mapType="image" var="imagePath" pathPrefix="/library/image/"/>									
									<h:graphicImage id="exampleFileIcon" value="#{imagePath}" />	
									<h:outputLink value="#{eachAttach.url}" target="_blank" title="#{msgs.openLinkNewWindow}">
										<h:outputText value=" "/><h:outputText value="#{eachAttach.name}"/>
									</h:outputLink>
								</h:column>
							</h:dataTable>
						<f:verbatim></div></div></f:verbatim>
					</t:dataList>
				<f:verbatim></div></f:verbatim>
				<h:outputText value="#{msgs.syllabus_noEntry}" styleClass="instruction" rendered="#{SyllabusTool.displayNoEntryMsg}"/>
			</syllabus:syllabus_if>				
			<syllabus:syllabus_ifnot test="#{SyllabusTool.syllabusItem.redirectURL}">
  			<syllabus:syllabus_iframe redirectUrl="#{SyllabusTool.syllabusItem.redirectURL}" width="100%" height="500"/>
			</syllabus:syllabus_ifnot>

		</h:form>
	</sakai:view_content>
	</sakai:view_container>
</f:view>
